<div class="main-content">

  <div class="header">
    <p>Lista de Pedidos</p>
  </div>

  <div class="filter">
    <input (ngModelChange)="search()" [(ngModel)]="searchValue" nz-input placeholder="Search..." type="text"/>
    <button (click)="openPedidoDrawer()" nz-button nzType="primary">Novo Pedido</button>
  </div>

  <div class="table-container">
    <div class="table-scroll">
      <nz-table [nzData]="listOfDisplayData" [nzScroll]="{ x: '800px', y: '280px'}" nzTableLayout="fixed">
        <thead>
        <tr>
          <th>ID</th>
          <th>Data Pedido</th>
          <th>Valor Total</th>
          <th>Status</th>
          <th>Cliente</th>
          <th>Created At</th>
          <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let pedido of listOfDisplayData">
          <td>{{ pedido.id }}</td>
          <td>{{ pedido.dataPedido | date: 'dd/MM/yyyy HH:mm' }}</td>
          <td>{{ pedido.valorTotal | currency:'USD' }}</td>
          <td>
            <nz-tag [nzColor]="pedido.status === 'PENDENTE' ? 'orange' : 'green'">
              {{ pedido.status }}
            </nz-tag>
          </td>
          <td>{{ pedido.clienteId }}</td>
          <td>{{ pedido.createdAt | date: 'dd/MM/yyyy HH:mm' }}</td>
          <td>
            <button (click)="deletePedido(pedido)" nz-button nzDanger nzSize="small" nzType="link">
              <nz-icon nzTheme="outline" nzType="delete"></nz-icon>
            </button>
            <button (click)="editPedido(pedido)" nz-button nzSize="small" nzType="link">
              <nz-icon nzTheme="outline" nzType="edit"></nz-icon>
            </button>
          </td>
        </tr>
        </tbody>
      </nz-table>
    </div>
  </div>
</div>

<!-- Drawer para criar/editar -->
<nz-drawer
  (nzOnClose)="closePedidoDrawer()"
  [nzTitle]="drawerTitle"
  [nzFooter]=nzPedidoDrawerFooter
  [nzVisible]="isPedidoDrawerVisible"
  [nzWidth]="480">
  <form *nzDrawerContent [formGroup]="pedidoForm" nz-form>
    <nz-form-item>
      <nz-form-label nzRequired>Data Pedido</nz-form-label>
      <nz-form-control>
        <input formControlName="dataPedido" type="datetime-local" nz-input />
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label nzRequired>Valor Total</nz-form-label>
      <nz-form-control>
        <input formControlName="valorTotal" type="number" nz-input />
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label nzRequired>Status</nz-form-label>
      <nz-form-control>
        <nz-select formControlName="status">
          <nz-option nzLabel="PENDENTE" nzValue="PENDENTE"></nz-option>
          <nz-option nzLabel="CONCLUIDO" nzValue="CONCLUIDO"></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label nzRequired>Cliente</nz-form-label>
      <nz-form-control>
        <input formControlName="clienteId" nz-input />
      </nz-form-control>
    </nz-form-item>
  </form>

  <ng-template #nzPedidoDrawerFooter>
    <button (click)="closePedidoDrawer()" nz-button>Cancelar</button>
    <button (click)="submitPedido()" [disabled]="!pedidoForm.valid" nz-button nzType="primary">Salvar</button>
  </ng-template>
</nz-drawer>
